<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evaluator Information</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
</head>
<body>
    <div class="container mt-5">
        <h2>Evaluator Information</h2>
        <form id="userInfoForm">
            <div class="mb-3">
                <label for="username" class="form-label">Username</label>
                <input type="text" class="form-control" id="username" name="username" required>
            </div>
            <div class="mb-3">
                <label for="age" class="form-label">Age</label>
                <input type="number" class="form-control" id="age" name="age" required>
            </div>
            <div class="mb-3">
                <label for="gender" class="form-label">Gender</label>
                <select class="form-select" id="gender" name="gender">
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Other">Other</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="occupation" class="form-label">Occupation</label>
                <input type="text" class="form-control" id="occupation" name="occupation" required>
            </div>
            <button type="submit" class="btn btn-primary">Submit</button>
        </form>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
    const userInfoForm = document.getElementById('userInfoForm');

    userInfoForm.addEventListener('submit', function(event) {
        event.preventDefault();

        const userData = {
            username: document.getElementById('username').value,
            age: document.getElementById('age').value,
            gender: document.getElementById('gender').value,
            occupation: document.getElementById('occupation').value
        };

        fetch('/submit_user', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(userData)
        })
        .then(response => response.json())
        .then(data => {
            // Capture the user_id from the response
            const userId = data.user_id;
            sessionStorage.setItem('user_id', userId);  // Store user_id in session storage

            console.log('User data submitted successfully:', data);

            // Pass the user_id to other functions or store it for later use
            prefetchEvaluationTask(1, userId);  
            //prefetchEvaluationTask(2, userId); 

            // Redirect to the instruction page after successful submission
            window.location.href = '/instructions';
        })
        .catch((error) => {
            console.error('Error submitting user:', error);
            alert('Error submitting user data');
        });
    });

    
    function prefetchEvaluationTask(taskId, userId) {
        fetch(`/get_evaluation_task/${taskId}?user_id=${userId}`)  // Pass user_id as query parameter
            .then(response => response.json())
            .then(data => {
                // Store prefetched data in session storage or handle as needed
                sessionStorage.setItem(`evaluation_task_${taskId}`, JSON.stringify(data));
            })
            .catch(error => console.error('Error prefetching task:', error));
    }
});

</script>
            
</body>
</html>
